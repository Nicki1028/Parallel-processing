## 平行處理資料載入/寫入速度

## 測量設備
### CPU i7-10700 
### Threads:16
### P-Core:8 E-Core:0
### RAM 40GB

順便看一下最終消耗的記憶體用量
### 實驗1 整份讀取+批次寫入 
* 每次批次都要清除記憶體 (100w~500w) step = 50w
#### 千萬
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|------|-----|-----|----|-----------|
| 1,000,000 | 14.29 | 17.24 | 36.84 | 2.3G |
| 1,500,000 | 13.15 | 15.36 | 31.42 | 2.3G |
| 2,000,000 | 15.42 | 30.82 | 48.18 | 2.5G |
| 2,500,000 | 17.22 | 36.29 | 54.6  | 2.5G |
| 3,000,000 | 17.37 | 20.97 | 40.02 | 2.2G |
| 3,500,000 | 13.38 | 21.5  | 35.8  | 1.8G |
| 4,000,000 | 15.89 | 23.15 | 40.06 | 2G |
| 4,500,000 | 17.76 | 26.08 | 45.02 | 2.3G |
| 5,000,000 | 24.39 | 59.06 | 84.12 | 2.5G |

#### 一千五百萬
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|------|-----|-----|----|-----------|
| 1,500,000 | 23.76 | 26.98 | 51.7  | 3.8G |
| 2,500,000 | error |  |  |  |
| 3,500,000 | 31.89 | 56.3  | 91.06 | 3.6G |

#### 兩千萬
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|------|-----|-----|----|-----------|
| 1,500,000 | 23.67 | 32.69 | 60.38 | 3.8G |
| 2,500,000 | 28.98 | 42.85 | 75.18 | 3.8G |
| 3,500,000 | 30.67 | 49.92 | 81.46 | 3.6G |


#### 千萬(優化後)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|------|
| 1,500,000 | 8.79  | 4.1  | 14.68 | 2.3G |
| 2,000,000 | 11.59 | 1.26 | 13.64 | 2.5G |
| 2,500,000 | 11.59 | 4.11 | 17.38 | 2.6G |
| 3,000,000 | 10.27 | 3.34 | 14.76 | 2.3G |
| 3,500,000 | 9.12 | 1.965 | 11.55 | 1.8G |
| 4,000,000 | 9.94 | 2.79 | 13.69 | 2G |
| 4,500,000 | 11.2 | 3.11 | 15.36 | 2.3G |

#### 兩千萬(優化後)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|----|
| 1,500,000 | 19.81 | 1.76 | 30.66 | 2G |
| 2,000,000 | 21    | 2.41 | 30.76 | 2.5G |
| 2,500,000 | 19.83 | 2.74 | 30.7  | 2.6G |
| 3,000,000 | 19.74 | 2.71 | 27.84 | 2.5G |
| 3,500,000 | 21.98 | 2.85 | 27.91 | 2.7G |
| 4,000,000 | 27.76 | 2.63 | 38.95 | 2.8G |
| 4,500,000 | 27    | 2.65 | 37.67 | 2.9G |

#### 三千萬(優化後)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|------|
| 1,500,000 | 28.84 | 2.08 | 47.99 | 2.5G |
| 2,000,000 | 29.15 | 2.98 | 44.86 | 2.7G |
| 2,500,000 | 29.99 | 2.73 | 47.58 | 2.7G |
| 3,000,000 | 30.3  | 2.98 | 47    | 3.2G |
| 3,500,000 | 31.97 | 3.56 | 46.05 | 3.6G |
| 4,000,000 | 32.5  | 3.12 | 50.12 | 3.3G |
| 4,500,000 | 33.09 | 3.41 | 48.56 | 3.7G |

#### 五千萬(優化後)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|------|
| 1,500,000 | 48.26 | 2.45 | 95.05 | 2.8G |
| 2,000,000 | 52.36 | 3.02 | 91.73 | 2.7G |
| 2,500,000 | 55.76 | 3.61 | 90.8  | 3.9G |
| 3,000,000 | 50.11 | 3.68 | 79.75 | 2.9G |
| 3,500,000 | 54.86 | 3.89 | 89.21 | 3.9G |
| 4,000,000 | 51.82 | 4.12 | 86.13 | 3.9G |
| 4,500,000 | 53.73 | 4.01 | 89.45 | 3.7G |


#### 七千萬(優化後)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|--------|------|
| 1,500,000 | 66.25 | 2.71 | 154.01 | 2.7G |
| 2,000,000 | 65.22 | 3.19 | 139.97 | 2.7G |
| 2,500,000 | 78.04 | 3.88 | 132.53 | 3.3G |
| 3,000,000 | 77.52 | 5.03 | 125.85 | 3.8G |
| 3,500,000 | 77.88 | 4.45 | 128.36 | 3.8G |
| 4,000,000 | 73.29 | 4.62 | 135.84 | 4.0G |
| 4,500,000 | 74.36 | 4.35 | 133.26 | 3.9G |


#### 千萬(parallel)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|------|------|-------|------|
| 1,500,000 | 6.88 | 1.77 | 14.19 | 2.2G |
| 2,000,000 | 9.03 | 2.38 | 16.78 | 3.3G |
| 2,500,000 | 9.17 | 4.8  | 17.95 | 3.9G |
| 3,000,000 | 11.31| 1.67 | 14.66 | 3.0G |
| 3,500,000 | 6.98 | 2.49 | 10.74 | 2.7G |
| 4,000,000 | 7.66 | 2.81 | 11.94 | 3.1G |
| 4,500,000 | 8.58 | 3.22 | 13.52 | 3.6G |

#### 兩千萬(parallel)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|------|
| 1,500,000 | 10.02 | 1.21 | 32.05 | 1.8G |
| 2,000,000 | 11.64 | 1.55 | 32.08 | 2.6G |
| 2,500,000 | 13.56 | 2.98 | 33.38 | 2.8G |
| 3,000,000 | 15.45 | 2.28 | 28.03 | 3.5G |
| 3,500,000 | 18.43 | 3.59 | 33.9  | 4.2G |
| 4,000,000 | 22.58 | 5.26 | 32.42 | 5.0G |
| 4,500,000 | 18.55 | 5.85 | 29.1  | 5.2G |

#### 三千萬(parallel)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|------|
| 1,500,000 | 10.28 | 1.15 | 50.13 | 2.2G |
| 2,000,000 | 12.1  | 1.93 | 49.47 | 3.1G |
| 2,500,000 | 14.9  | 2.12 | 47.85 | 3.2G |
| 3,000,000 | 16.48 | 2.37 | 49.78 | 4.4G |
| 3,500,000 | 14.77 | 2.99 | 41.35 | 5.6G |
| 4,000,000 | 18.03 | 3.89 | 41.65 | 5.4G |
| 4,500,000 | 20.97 | 4.90 | 41.62 | 6.0G |

#### 五千萬(parallel)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|-------|------|
| 1,500,000 | 10.95 | 0.74 | 86.25 | 2.2G |
| 2,000,000 | 14.37 | 0.93 | 81.31 | 3.2G |
| 2,500,000 | 16.2  | 1.44 | 81.92 | 3.8G |
| 3,000,000 | 16.98 | 2.08 | 73.63 | 4.4G |
| 3,500,000 | 20.6  | 2.8  | 74.11 | 5.4G |
| 4,000,000 | 22.79 | 4.36 | 78.3  | 5.0G |
| 4,500,000 | 22.89 | 3.08 | 74.93 | 6.7G |

#### 七千萬(parallel)
| 筆數 | 平均讀取秒數(s) | 平均寫入秒數(s) | 總執行時間(s) |  記憶體用量(GB) |
|-----------|-------|------|--------|------|
| 1,500,000 | 12.54 | 0.49 | 129.68 | 2.1G |
| 2,000,000 | 15.62 | 0.84 | 122.55 | 2.5G |
| 2,500,000 | 17.72 | 1.27 | 116    | 3.6G |
| 3,000,000 | 19.9  | 1.82 | 113.71 | 4.5G |
| 3,500,000 | 23.13 | 2.51 | 112.01 | 5.4G |
| 4,000,000 | 26.18 | 3.14 | 108.57 | 5.1G |
| 4,500,000 | 26.42 | 3.07 | 109    | 6.8G |


---






## Benchmark 效能比對

### 針對單一字串進行Split & Span 比較
| Method | Mean     | Error   | StdDev  | Gen0   | Allocated |
|------- |---------:|--------:|--------:|-------:|----------:|
| Split  | 244.6 ns | 1.08 ns | 1.01 ns | 0.1121 |     589 B |
| Span   | 286.7 ns | 1.26 ns | 1.17 ns | 0.0501 |     264 B |

### 針對單一字串進行Split & Span 比較 (300萬)
| Method | Mean     | Error   | StdDev  | Gen0   | Allocated |
|------- |---------:|--------:|--------:|-------:|----------:|
| Split  | 244.6 ns | 1.08 ns | 1.01 ns | 0.1121 |     1.5 GB |
| Span   | 286.7 ns | 1.26 ns | 1.17 ns | 0.0501 |     600 MB |

### 針對單一字串進行Split & Span 比較 + 反射

| Method | Mean     | Error     | StdDev    | Median   | Gen0   | Allocated |
|------- |---------:|----------:|----------:|---------:|-------:|----------:|
| Split  | 1.433 us | 0.0285 us | 0.0453 us | 1.403 us | 0.1717 |     901 B |
| Span   | 1.502 us | 0.0076 us | 0.0071 us | 1.501 us | 0.1087 |     577 B |

### 針對單一字串進行Split & Span 比較 +  property只找一次 

| Method | Mean     | Error     | StdDev    | Gen0   | Allocated |
|------- |---------:|----------:|----------:|-------:|----------:|
| Split  | 1.410 us | 0.0023 us | 0.0019 us | 0.1717 |     901 B |
| Span   | 1.375 us | 0.0056 us | 0.0050 us | 0.1030 |     541 B |

### 針對單一字串進行Split & Span 比較 +  property只找一次 + List只創建一次
| Method | Mean     | Error     | StdDev    | Gen0   | Allocated |
|------- |---------:|----------:|----------:|-------:|----------:|
| Split  | 1.410 us | 0.0023 us | 0.0019 us | 0.1717 |     901 B |
| Span   | 1.375 us | 0.0056 us | 0.0050 us | 0.1030 |     489 B |

### 針對單一字串進行Split & Span 比較 +  property只找一次 + List只創建一次 + 暫存反射SetValue方法只執行一次
| Method | Mean       | Error   | StdDev  | Gen0   | Allocated |
|------- |-----------:|--------:|--------:|-------:|----------:|
| Split  | 1,416.7 ns | 4.62 ns | 4.32 ns | 0.1717 |     901 B |
| Span   |   403.8 ns | 1.60 ns | 1.50 ns | 0.0563 |     296 B |

### 針對單一字串進行Split & Span 比較 + 反射(300萬)
| Method | Mean    | Error    | StdDev   | Gen0        | Gen1      | Allocated |
|------- |--------:|---------:|---------:|------------:|----------:|----------:|
| Split  | 4.253 s | 0.0090 s | 0.0084 s | 515000.0000 | 1000.0000 |   2.52 GB |
| Span   | 4.451 s | 0.0095 s | 0.0089 s | 330000.0000 |         - |   1.61 GB |

### 針對單一字串進行Split & Span 比較 + 反射+ property只找一次 (300萬)
| Method | Mean    | Error    | StdDev   | Gen0        | Gen1      | Allocated |
|------- |--------:|---------:|---------:|------------:|----------:|----------:|
| Split  | 4.234 s | 0.0116 s | 0.0103 s | 515000.0000 | 1000.0000 |   2.52 GB |
| Span   | 4.110 s | 0.0134 s | 0.0126 s | 309000.0000 |         - |   1.51 GB |

### 針對單一字串進行Split & Span 比較 +  property只找一次 + List只創建一次 + 暫存反射SetValue方法只執行一次(300萬)
| Method | Mean    | Error    | StdDev   | Gen0        | Gen1      | Allocated  |
|------- |--------:|---------:|---------:|------------:|----------:|-----------:|
| Split  | 4.291 s | 0.0287 s | 0.0224 s | 515000.0000 | 1000.0000 | 2579.02 MB |
| Span   | 1.187 s | 0.0050 s | 0.0047 s | 169000.0000 |         - |  848.11 MB |

### 針對單一字串進行Split & Span 比較 +  property只找一次 + List只創建一次 + 暫存反射SetValue方法只執行一次 + 同時找到後就執行反射裝進去物件(300萬)
| Method              | Mean    | Error    | StdDev   | Gen0        | Gen1      | Allocated  |
|-------------------- |--------:|---------:|---------:|------------:|----------:|-----------:|
| Split               | 4.253 s | 0.0204 s | 0.0181 s | 515000.0000 | 1000.0000 | 2579.02 MB |
| Span                | 1.181 s | 0.0033 s | 0.0031 s | 169000.0000 |         - |  848.11 MB |
| ParseAndSetDirectly | 1.023 s | 0.0039 s | 0.0036 s | 148000.0000 |         - |  744.96 MB |

### 寫入 (物件轉字串) 300萬
| Method        | Mean    | Error    | StdDev   | Gen0        | Allocated |
|-------------- |--------:|---------:|---------:|------------:|----------:|
| Write         | 3.103 s | 0.0293 s | 0.0245 s | 421000.0000 |   2.06 GB |
| OptimizeWrite | 3.088 s | 0.0247 s | 0.0231 s | 249000.0000 |   1.22 GB |

### 寫入 (物件轉字串) 300萬 + StringBuilder拆兩行寫
| Method        | Mean    | Error    | StdDev   | Gen0        | Allocated  |
|-------------- |--------:|---------:|---------:|------------:|-----------:|
| Write         | 3.068 s | 0.0299 s | 0.0250 s | 421000.0000 | 2108.82 MB |
| OptimizeWrite | 2.789 s | 0.0061 s | 0.0057 s | 112000.0000 |  561.59 MB |
 
### 寫入 (物件轉字串) 300萬 + StringBuilder拆兩行寫 + 反射只返一次
| Method        | Mean       | Error    | StdDev   | Gen0        | Allocated  |
|-------------- |-----------:|---------:|---------:|------------:|-----------:|
| Write         | 3,057.9 ms | 14.62 ms | 11.41 ms | 421000.0000 | 2108.82 MB |
| OptimizeWrite |   544.9 ms |  1.73 ms |  1.53 ms | 112000.0000 |  561.59 MB |

## 測試 拿掉最後轉字串
| Method        | Mean       | Error    | StdDev   | Gen0        | Allocated  |
|-------------- |-----------:|---------:|---------:|------------:|-----------:|
| Write         | 3,106.5 ms | 61.88 ms | 82.61 ms | 421000.0000 | 2108.82 MB |
| OptimizeWrite |   413.3 ms |  2.79 ms |  2.61 ms |  18000.0000 |   91.69 MB |

## 捨棄字串轉字元陣列
| Method        | Mean       | Error    | StdDev   | Gen0        | Allocated  |
|-------------- |-----------:|---------:|---------:|------------:|-----------:|
| Write         | 3,074.6 ms | 31.92 ms | 28.29 ms | 421000.0000 | 2108.82 MB |
| OptimizeWrite |   521.7 ms |  1.97 ms |  1.84 ms |  18000.0000 |   91.69 MB |



## 準備 2000,3000,5000,7000,1E檔案
## 把優化的版本藤道CSV